# 智能行为检测系统 - 项目功能文档

## 📋 项目概述

智能行为检测系统是一个基于YOLOv8+SlowFast算法的实时行为识别平台，支持视频文件检测和实时摄像头监控，能够识别多种人体行为并进行异常报警。

### 🎯 核心功能
- **视频文件检测**: 支持多种格式视频上传和批量处理
- **实时监控**: 多路摄像头同时监控，实时行为识别
- **智能报警**: 自动识别异常行为并及时报警
- **数据分析**: 丰富的统计图表和可视化展示
- **Web界面**: 美观易用的管理界面
- **目标跟踪**: DeepSort算法实现精准目标跟踪
- **实时通信**: WebSocket实现实时数据推送

### 🧠 检测能力
系统可以识别以下人体行为：
- 🚶‍♂️ 正常行走 (walk)
- 🏃‍♂️ 奔跑 (run) - 低级别报警
- 🤸‍♂️ 跌倒 (fall down) - **高级别报警**
- 👊 打斗 (fight) - **高级别报警**
- 🚪 进入/离开 (enter/exit) - 中级别报警
- 🪑 坐下/站立 (sit/stand)

## 🏗️ 技术架构

### 技术栈
- **后端**: Flask + SQLite + WebSocket
- **前端**: Vue.js 3 + Element Plus + ECharts
- **算法**: YOLOv8 + SlowFast + DeepSort
- **数据库**: SQLite
- **实时通信**: Socket.IO

### 项目结构
```
behavior_identify/
├── backend/                  # 后端Flask应用
│   ├── app.py               # 主应用文件
│   ├── models/              # 数据模型
│   │   └── database.py      # 数据库模型定义
│   ├── services/            # 业务逻辑服务
│   │   ├── detection_service.py      # 检测服务
│   │   └── realtime_statistics.py   # 实时统计
│   ├── utils/               # 工具函数
│   │   ├── file_utils.py    # 文件处理工具
│   │   └── logger.py        # 日志工具
│   ├── config/              # 配置文件
│   ├── uploads/             # 上传文件目录
│   ├── outputs/             # 输出文件目录
│   └── requirements.txt     # Python依赖
├── frontend/                # 前端Vue应用
│   ├── src/
│   │   ├── views/           # 页面组件
│   │   ├── utils/           # 工具函数
│   │   ├── store/           # Vuex状态管理
│   │   └── styles/          # 样式文件
│   └── package.json         # Node.js依赖
├── yolo_slowfast-master/    # 核心算法模块
│   ├── yolo_slowfast.py     # 主算法文件
│   ├── deep_sort/           # 目标跟踪算法
│   ├── selfutils/           # 工具函数
│   └── requirements.txt     # 算法依赖
└── README.md                # 项目说明
```

## 🖥️ 前端功能模块

### 1. 系统概览 (Dashboard.vue)
- **功能**: 系统状态总览，实时统计数据展示
- **组件**: 统计卡片、图表展示、系统状态监控
- **数据**: 活跃任务数、今日报警数、总检测数、系统运行时间

### 2. 视频上传 (VideoUpload.vue)
- **功能**: 视频文件上传和检测配置
- **支持格式**: MP4, AVI, MOV, WMV等
- **配置项**: 
  - 置信度阈值 (0.1-1.0)
  - 输入尺寸 (320/640/1280)
  - 设备类型 (CPU/GPU)
  - 报警行为选择
- **流程**: 文件上传 → 参数配置 → 启动检测 → 进度监控 → 结果查看

### 3. 实时监控 (RealtimeMonitor.vue)
- **功能**: 摄像头实时监控和行为检测
- **特性**: 
  - 多摄像头支持 (0-9号摄像头)
  - 实时视频流显示
  - 实时检测结果展示
  - 报警行为配置
  - 统计数据实时更新
- **控制**: 开始监控、停止监控、参数调整

### 4. 任务管理 (TaskManager.vue)
- **功能**: 检测任务的管理和监控
- **操作**: 查看任务列表、任务详情、删除任务、下载结果
- **状态**: pending(待处理)、running(运行中)、completed(已完成)、failed(失败)
- **筛选**: 按状态、类型、时间筛选

### 5. 报警记录 (AlertRecords.vue)
- **功能**: 异常行为报警的记录和管理
- **信息**: 报警类型、触发时间、置信度、处理状态
- **操作**: 确认报警、标记已处理、添加备注
- **状态**: active(活跃)、acknowledged(已确认)、resolved(已解决)

### 6. 数据统计 (Statistics.vue)
- **功能**: 系统数据的统计分析和可视化
- **图表类型**:
  - 行为分布饼图
  - 时间趋势折线图
  - 报警级别分布
  - 24小时时段分析
- **时间范围**: 24小时、7天、30天、90天、自定义
- **导出**: 支持CSV格式数据导出

### 7. 系统设置 (Settings.vue)
- **功能**: 系统参数配置和管理
- **配置项**: 检测参数、报警设置、系统配置
- **管理**: 用户管理、权限设置、日志查看

## 🔧 后端API接口

### 1. 系统接口
- `GET /` - 系统首页信息
- `GET /api/health` - 健康检查
- `GET /api/system/uptime` - 系统运行时间

### 2. 文件上传接口
- `POST /api/upload` - 视频文件上传
  - 参数: video(文件), task_name, confidence, input_size, device
  - 返回: taskId, filename, file_path

### 3. 检测控制接口
- `POST /api/detect/video` - 启动视频检测
- `POST /api/detect/realtime` - 启动实时检测
- `POST /api/detect/stop/<task_id>` - 停止检测任务
- `POST /api/stop_monitoring` - 停止实时监控

### 4. 视频流接口
- `GET /api/realtime_feed` - 实时检测视频流
- `GET /video_feed` - 视频流(兼容接口)
  - 参数: source, device, input_size, confidence, preview_only, alert_behaviors

### 5. 数据查询接口
- `GET /api/tasks` - 获取任务列表
  - 参数: page, per_page, status, type
- `GET /api/tasks/<task_id>` - 获取任务详情
- `GET /api/tasks/<task_id>/results` - 获取任务完整结果
- `DELETE /api/tasks/<task_id>` - 删除任务

### 6. 报警管理接口
- `GET /api/alerts` - 获取报警记录
- `POST /api/alerts/<alert_id>/status` - 更新报警状态

### 7. 统计分析接口
- `GET /api/statistics` - 获取基础统计信息
- `GET /api/statistics/overview` - 获取概览统计
- `GET /api/statistics/charts` - 获取图表数据
- `GET /api/statistics/export` - 导出统计数据

### 8. 文件服务接口
- `GET /api/download/result/<task_id>` - 下载检测结果
- `GET /api/outputs/<filename>` - 静态文件访问(支持Range请求)

### 9. WebSocket接口
- 命名空间: `/detection`
- 事件:
  - `progress_update` - 进度更新
  - `task_completed` - 任务完成
  - `task_failed` - 任务失败
  - `realtime_result` - 实时检测结果

## 🤖 核心算法模块

### YOLOv8目标检测
- **模型**: yolov8n.pt (轻量级版本)
- **功能**: 人体目标检测和定位
- **输出**: 边界框坐标、置信度、类别

### SlowFast行为识别
- **模型**: SLOWFAST_8x8_R50_DETECTION.pyth
- **功能**: 基于视频序列的行为分类
- **支持行为**: 80种AVA数据集行为类别

### DeepSort目标跟踪
- **模型**: ckpt.t7
- **功能**: 多目标跟踪，为每个检测对象分配唯一ID
- **特性**: 处理遮挡、重新识别

### 集成流程
1. **视频输入** → YOLOv8检测人体目标
2. **目标框** → DeepSort分配跟踪ID
3. **视频序列** → SlowFast识别行为类型
4. **结果融合** → 输出最终检测结果

## 💾 数据库设计

### 1. 检测任务表 (detection_tasks)
```sql
- id: 主键
- task_name: 任务名称
- source_type: 源类型(video/camera)
- source_path: 源路径
- output_path: 输出路径
- status: 状态(pending/running/completed/failed)
- progress: 进度(0-100)
- created_at/started_at/completed_at: 时间戳
- confidence_threshold: 置信度阈值
- input_size: 输入尺寸
- device: 设备类型
- total_frames/processed_frames: 帧数统计
- detected_objects/detected_behaviors: 检测统计
```

### 2. 检测结果表 (detection_results)
```sql
- id: 主键
- task_id: 关联任务ID
- frame_number: 帧号
- timestamp: 时间戳
- object_id: 目标跟踪ID
- object_type: 目标类型
- confidence: 检测置信度
- bbox_x1/y1/x2/y2: 边界框坐标
- behavior_type: 行为类型
- behavior_confidence: 行为置信度
- is_anomaly: 是否异常行为
- velocity_x/y: 速度信息
```

### 3. 报警记录表 (alert_records)
```sql
- id: 主键
- task_id: 关联任务ID
- alert_type: 报警类型
- status: 处理状态(active/acknowledged/resolved)
- trigger_frame: 触发帧号
- trigger_timestamp: 触发时间
- trigger_object_id: 触发目标ID
- trigger_behavior: 触发行为
- trigger_confidence: 触发置信度
- description: 描述信息
- acknowledged_at/by: 确认信息
- resolved_at: 解决时间
- note: 备注
```

### 4. 系统配置表 (system_configs)
```sql
- id: 主键
- config_key: 配置键
- config_value: 配置值
- config_type: 配置类型
- description: 描述
- created_at/updated_at: 时间戳
```

### 5. 系统日志表 (system_logs)
```sql
- id: 主键
- level: 日志级别
- message: 日志消息
- module: 模块名称
- function: 函数名称
- line_number: 行号
- created_at: 创建时间
```

## 🚀 部署和运行

### 环境要求
- Python 3.8+
- Node.js 16+
- CUDA (可选，用于GPU加速)

### 安装步骤

1. **克隆项目**
```bash
git clone [repository-url]
cd behavior_identify
```

2. **后端环境**
```bash
cd backend
pip install -r requirements.txt
```

3. **前端环境**
```bash
cd frontend
npm install
```

4. **算法依赖**
```bash
cd yolo_slowfast-master
pip install -r requirements.txt
```

### 启动服务

1. **启动后端**
```bash
cd backend
python app.py
```
- 服务地址: http://localhost:5000
- WebSocket: ws://localhost:5000/detection

2. **启动前端**
```bash
cd frontend
npm run serve
```
- 访问地址: http://localhost:8080

### 配置说明

1. **后端配置** (backend/config/config.py)
- 数据库连接
- 文件上传路径
- 日志配置
- WebSocket配置

2. **前端配置** (frontend/vue.config.js)
- API代理配置
- 构建配置
- 开发服务器配置

3. **算法配置**
- 模型文件路径
- 设备选择(CPU/GPU)
- 检测参数

## 📝 开发说明

### 代码规范
- 后端: PEP 8 Python代码规范
- 前端: Vue.js官方风格指南
- 注释: 中文注释，详细说明功能

### 扩展指南
1. **添加新的行为类型**: 修改AVA标签文件和前端配置
2. **集成新算法**: 在detection_service.py中添加新的检测方法
3. **扩展API**: 在app.py中添加新的路由和处理函数
4. **前端功能**: 在views目录下添加新的Vue组件

### 调试技巧
1. **后端调试**: 查看logs/app.log日志文件
2. **前端调试**: 使用浏览器开发者工具
3. **算法调试**: 启用详细日志输出
4. **WebSocket调试**: 使用Socket.IO调试工具

---

*文档版本: v1.0*  
*最后更新: 2025-01-04*
